# Day 23: only perl can parse Perl

*... but there is always one more way to approach things!*

[Get your flag here ...](files/onlyperl.pl "onlyperl.pl")

(in doubt, use perl5.10+ on *nix)

### Solution

Given [onlyperl.pl](files/onlyperl.pl "onlyperl.pl") file is a compiled Perl script. The first thing to do was to decompile it.

```bash
$ perl -MO=Deparse onlyperl.pl > onlyperl-decompiled.pl
onlyperl.pl syntax OK
``` 

The [result file](files/onlyperl-decompiled.pl "onlyperl-decompiled.pl") somewhat looks like a source code now, but it's still obfuscated. After a few minutes of playing with Perl debugger I managed to get a [more readable](files/onlyperl-deobfuscated.pl "onlyperl-deobfuscated.pl") version of it.

```perl
$_ = 'A"&j[7DO]3nn^R&Hr\\[O8A#3;a["3Q>DOgCO(I(8A#,;a["3Q>DOgCO(I48A#Q;a["3Q>DOgCO(nQ3~3&LmV8A"&j[7DQG&DDI,/I=osI3/I=obIQ/I=:UobFt<FF8.Ft``88LKR&DFJJIk,8A"&j[7LO\\[0vQ&!"7jR[LHR[v(L3&vL!RaLG3""!L[R^9\\[OA';

print("Password:\n");

@a=('187', '0', '0', '128', '183', '26', '1', '77', '67', '129', '251', '14', '3', '124', '244', '243', '130', '76', '244', '94', '77', '165', '219', '77', '247', '130', '76', '249', '68', '128', '108', '253', '71', '249', '65', '247', '93', '78', '139', '75', '93', '78', '133', '128', '108', '247', '129', '76', '249', '68', '128', '108', '205', '115', '92', '78', '69', '56', '34', '243', '175', '76', '244', '67', '77', '165', '39', '77', '247', '175', '76', '249', '68', '128', '108', '253', '71', '249', '65', '247', '66', '73', '139', '75', '66', '73', '133', '128', '108', '247', '129', '76', '249', '68', '128', '108', '205', '115', '93', '73', '72', '56', '14', '124', '150', '243', '77', '77', '199', '193', '189', '76', '196', '189', '254', '69', '187', '190', '197', '174', '79', '194', '95', '78', '205', '164', '195', '197', '134', '199', '194', '67', '79', '196', '189', '254', '72', '187', '190', '197', '174', '127', '194', '92', '73', '197', '193', '189', '76', '11', '204', '179', '83', '77', '49', '157', '247', '189', '76', '249', '68', '128', '108', '247', '129', '76', '249', '68', '128', '108', '249', '1', '128', '108', '246', '77', '77', '196', '149', '72', '103', '77', '125', '77', '14', '116', '134', '49', '185', '142', '77', '77', '77', '64', '71', '105', '89', '88', '65', '16', '6', '16', '17', '92', '15', '31', '10', '11', '12', '21', '7', '16', '77', '86', '85', '89', '88', '65', '36', '44', '49', '93', '31', '16', '26', '28', '66', '91', '94', '175', '214', '84', '27', '21', '233', '2', '103', '23', '194', '20', '201', '229', '243', '29', '88', '181', '105', '153', '11', '50', '177', '174', '170', '2', '213', '18', '240', '41', '136', '0', '217', '27', '74', '148', '169', '179', '118', '226', '4', '220', '83', '82', '142', '208', '172', '89', '234', '252', '216', '76', '215', '254', '3', '133', '64', '37', '161', '214', '88', '197', '11', '182', '45', '183', '186', '236', '145', '242', '232', '34', '160', '85', '131', '164', '219', '224', '174', '15', '33', '231', '109', '62', '180', '184', '87', '178', '246', '110', '227', '31', '47', '149', '93', '79', '77', '218', '181', '254', '101', '209', '125', '54', '155', '22', '103', '68', '97', '251', '14', '177', '94', '253', '70', '136', '223', '28', '32', '102', '146', '243', '35', '39', '51', '170', '171', '25', '210', '175', '20', '141', '140', '129', '233', '17', '204', '7', '194', '66', '156', '167', '44', '190', '111', '189', '98', '150', '46', '221', '137', '222', '200', '154', '48', '213', '193', '241', '138', '143', '100', '81', '117', '239', '49', '126', '176', '13', '188', '238', '53', '163', '24', '72', '12', '95', '212', '245', '165', '162', '119', '207', '96', '8', '144', '36', '128', '60', '92', '41', '80', '57', '130', '192', '40', '58', '211', '202', '124', '113', '105', '247', '235', '55', '134', '157', '56', '191', '114', '9', '206', '203', '225', '158', '249', '168', '67', '38', '26', '121', '61', '237', '173', '228', '106', '23', '19', '86', '185', '91', '127', '112', '69', '42', '198', '90', '63', '52', '196', '244', '1', '71', '65', '166', '240', '153', '229', '59', '132', '75', '84', '199', '99', '139', '5', '195', '147', '21', '230', '152', '122', '10', '50', '151', '159', '2', '135', '120', '16', '43', '107', '205', '104', '123', '248', '6', '115', '250', '18', '78', '29', '30', '73', '108', '201', '116', '187');
@b=('147', '38', '197', '62', '125', '34', '250', '66', '70', '126', '248', '8', '201', '126', '244', '243', '63', '147', '240', '70', '90', '102', '229', '72', '252', '127', '65', '242', '66', '65', '105', '248', '70', '52', '62', '236', '93', '15', '130', '70', '95', '40', '90', '121', '106', '171', '139', '71', '254', '52', '135', '104', '216', '108', '13', '78', '61', '105', '42', '154', '183', '78', '241', '72', '253', '229', '32', '70', '252', '99', '64', '230', '66', '112', '112', '229', '82', '0', '55', '163', '34', '126', '145', '62', '26', '231', '99', '117', '95', '57', '132', '70', '1', '62', '133', '31', '208', '99', '106', '53', '1', '59', '11', '108', '70', '54', '73', '57', '204', '193', '110', '60', '195', '242', '5', '236', '194', '193', '202', '90', '68', '8', '88', '67', '134', '163', '194', '192', '141', '183', '133', '63', '91', '202', '125', '236', '65', '249', '129', '188', '172', '133', '191', '22', '227');
@c=unpack("C*",scalar <>);

print(chr(($b[$_]-$a[$_]+$c[$_%8]+0x100)&0xFF)) for(0..$#b);
print "\nDecryption done, are you happy now?\n"
```

The program asks for a password which is then used to decrypt the content hidden inside. After brute-forcing it I got password `p0lyglot` but it resulted in an unexpected output.

```bash
$ ./onlyperl-decompiled.pl
Password:
p0lyglot
HV17-this-is-not-what-you-are-looking-for
Are you sure that only perl can parse Perl?
Microsoft's ye old shell does not even know /usr/bin/perl.

Decryption done, are you happy now?
```

Hmm, "*Microsoft's ye old shell*"... This have to be reference to MS-DOS. I renamed the original perl file to [onlyperl.com](files/onlyperl.com) and ran it under DosBOX.

```commandline
$ onlyperl.com
>> perl password: p0lyglot
>> DOS code:
```

After entering Perl password again I was asked for a DOS code. I played a bit wit this input and found out that only 5 characters long codes are producing an output. I brute-forced it again and got the right code `S4n7A`.

The result flag:

```
HV17-Ovze-IUGF-W2xs-x2uE-pVRU
```